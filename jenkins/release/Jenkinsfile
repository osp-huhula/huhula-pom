node {	
	
	def MVN_HOME = tool 'maven-3.5.3';
	echo "MVN_HOME = ${MVN_HOME}"
	def JAVA_HOME = tool 'JDK7';
	echo "JAVA_HOME = ${JAVA_HOME}"
	
    parameters {
	    string (
	        defaultValue: '0.0.0',
	        description: '',
	        name : 'VERSION_RELEASE	')
	    string (
	        defaultValue: '0.0.0-SNAPSHOT',
	        description: '',
	        name : 'VERSION_DEVELOPMENT')
    }
	stage("Parameters"){
		echo "VERSION_RELEASE : ${VERSION_RELEASE}"
		echo "VERSION_DEVELOPMENT : ${VERSION_DEVELOPMENT}"
		if ("${params.VERSION_RELEASE}" == "" || "${params.VERSION_DEVELOPMENT}" == "") {
	        currentBuild.result = 'ABORTED'
	        error("Not valid values: VERSION_RELEASE(${VERSION_RELEASE}) | VERSION_DEVELOPMENT(${VERSION_DEVELOPMENT})")
		}
		if ("${params.VERSION_RELEASE}" == "0.0.0" || "${params.VERSION_DEVELOPMENT}" == "0.0.0-SNAPSHOT") {
	        currentBuild.result = 'ABORTED'
	        error("Not valid values: VERSION_RELEASE(${VERSION_RELEASE}) | VERSION_DEVELOPMENT(${VERSION_DEVELOPMENT})")
		}
		
	}
	stage("Cleaning"){
	    cleanWs();
	}
	stage("Cheking out (GIT)") {
		checkout scm
	}
	stage("Update all version (super-pom)") {
		if (isUnix()) {
			sh  "mvn versions:set -DnewVersion=${params.VERSION_RELEASE} -f huhula-super-pom/pom.xml -DprocessAllModules -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn versions:set -DnewVersion=${params.VERSION_RELEASE} -f .\huhula-super-pom\pom.xml -DprocessAllModules -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}
	}
	stage("Build (super-pom)") {
		if (isUnix()) {
			sh  "mvn clean deploy site -f huhula-super-pom/pom.xml -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn clean deploy site -f huhula-super-pom\pom.xml -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}
	}
	stage("Maven - Deploy (parent-pom)") {
		if (isUnix()) {
			sh  "mvn clean deploy site -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn clean deploy site -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}
	}
	stage("Maven - Site") {
		if (isUnix()) {
			sh "mvn site -Dmvn.project.location=${WORKSPACE} -Dmvn.verify.fail=false -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn site -Dmvn.project.location=${WORKSPACE} -Dmvn.verify.fail=false -Dmvn.antrun.config.skip.echoproperties=true "/)
		}
	}
	stage("Revert version (super-pom)") {
		if (isUnix()) {
			sh "mvn -f huhula-super-pom/pom.xml versions:revert -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn -f huhula-super-pom\pom.xml versions:revert -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}		
	}
	stage("Revert version (parent-pom)") {
		if (isUnix()) {
			sh "mvn versions:revert -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn versions:revert -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}		
	}
	stage("Release - prepare (dry)") {
		if (isUnix()) {
			sh "mvn release:clean release:prepare -Dresume=false -DdryRun=true --batch-mode -Dtag=${VERSION_RELEASE} -DreleaseVersion=${VERSION_RELEASE} -DdevelopmentVersion=${VERSION_DEVELOPMENT} -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn release:clean release:prepare -Dresume=false -DdryRun=true --batch-mode -Dtag=${VERSION_RELEASE} -DreleaseVersion=${VERSION_RELEASE} -DdevelopmentVersion=${VERSION_DEVELOPMENT} -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}		
	}
	stage("Release - revert") {
		if (isUnix()) {
			sh "mvn release:rollback -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn release:rollback -Dmvn.antrun.config.skip.echoproperties=true "/)
		}		
	}
	stage("Release - prepare") {
		if (isUnix()) {
			sh "mvn release:clean release:prepare -Dresume=false -DdryRun=false --batch-mode -Dtag=${VERSION_RELEASE} -DreleaseVersion=${VERSION_RELEASE} -DdevelopmentVersion=${VERSION_DEVELOPMENT} -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn release:clean release:prepare -Dresume=false -DdryRun=false --batch-mode -Dtag=${VERSION_RELEASE} -DreleaseVersion=${VERSION_RELEASE} -DdevelopmentVersion=${VERSION_DEVELOPMENT} -Dmvn.project.location=${WORKSPACE} -Dmvn.antrun.config.skip.echoproperties=true "/)
		}		
	}
	stage("Release - clean") {
		if (isUnix()) {
			sh "mvn release:clean -Dmvn.antrun.config.skip.echoproperties=true "
		} else {
			bat(/"mvn release:clean -Dmvn.antrun.config.skip.echoproperties=true "/)
		}		
	}
}

